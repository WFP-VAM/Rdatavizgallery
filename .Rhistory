library(tidyverse)
library(labelled)
library(expss)
library(haven)
#library(devtools)
#install_github("WFP-VAM/wfpthemes")
library(wfpthemes)
#load data set
data <- haven::read_sav("data/sampledataenglish.sav")
library(tidyverse)
library(labelled)
library(expss)
library(haven)
#library(devtools)
#install_github("WFP-VAM/wfpthemes")
library(wfpthemes)
#load data set
data <- haven::read_sav("data/sampledataenglish.sav")
#calculate FCS & FCG
#calculate FCS
data <- data %>% mutate(FCS = (2 * FCSStap) +(3 * FCSPulse) +(4*FCSPr) +(4*FCSDairy) +FCSVeg  +FCSFruit +(0.5*FCSFat) +(0.5*FCSSugar))
var_label(data$FCS) <- "Food Consumption Score"
#create FCG groups based on 21/25 or 28/42 thresholds
#Use this when analyzing a country with low consumption of sugar and oil - thresholds 21-35
data <- data %>% mutate(FCSCat21 = case_when(
FCS <= 21 ~ 1, between(FCS, 21.5, 35) ~ 2, FCS > 35 ~ 3))
val_lab(data$FCSCat21) = num_lab("
1 Poor
2 Borderline
3 Acceptable
")
var_label(data$FCSCat21) <- "FCS Categories"
#make table of FCG by admin1
fcscat21_admin1_table_long <- data %>%
group_by(ADMIN1Name = to_factor(ADMIN1Name)) %>%
count(FCSCat21 = as.character(FCSCat21)) %>%
mutate(perc = 100 * n / sum(n)) %>%
ungroup() %>% select(-n) %>% mutate_if(is.numeric, round, 1)
#stacked bar chart of fcg by Admin1
fcg_colors = c("Acceptable" = "#27AE60","Borderline" = "#F1C40F","Poor" = "#C0392B")
fcscat21_barplot <- fcscat21_admin1_table_long  %>%  ggplot(aes(fill=FCSCat21, y=perc, x=ADMIN1Name, label = perc)) +geom_bar(position="fill", stat="identity") +theme_wfp(grid = FALSE, axis = "y", axis_title = FALSE, axis_text = "y")
fcscat21_barplot <- fcscat21_barplot +scale_y_continuous(labels = scales::percent) +scale_fill_manual(values=fcg_colors) +  labs(
title = "Percentage of Households with Poor/Borderline Food Consumption by Region | April 2023",
subtitle = "",
x = "",
y = "",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)
fcscat21_barplot
fcscat21_barplot2 <- ggplot(fcscat21_admin1_table_long) +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7)
+geom_text(aes(x = ADMIN1Name,y = perc,color = FCSCat21,label = perc))
fcscat21_barplot2 <- ggplot(fcscat21_admin1_table_long) +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7)
+geom_text(aes(x = ADMIN1Name,y = perc,color = FCSCat21,label = perc))
fcscat21_barplot2 <- fcscat21_admin1_table_long %>% ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7)
+geom_text(aes(x = ADMIN1Name,y = perc,color = FCSCat21,label = perc))
fcscat21_barplot2 <- fcscat21_admin1_table_long %>% ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +geom_text(aes(x = ADMIN1Name,y = perc,color = FCSCat21,label = perc))
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>% ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7)
+geom_text(aes(x = ADMIN1Name,y = perc,color = FCSCat21,label = perc))
fcscat21_barplot2 <- fcscat21_admin1_table_long %>% ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7)
+geom_text(aes(x = ADMIN1Name,y = perc,color = FCSCat21,label = perc))
fcscat21_barplot2 <- fcscat21_admin1_table_long %>% ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,color = FCSCat21,label = perc))
fcscat21_barplot2 <- fcscat21_admin1_table_long %>% ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,color = FCSCat21,label = perc,color = fcg_colors,label = perc))
fcscat21_barplot2 <- fcscat21_admin1_table_long %>% ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,color = fcg_colors,label = perc))
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>% ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = fcg_colors,label = perc))
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc)) +
scale_color_manual(values = c(main_white, main_black, main_white)) +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc)) #+
#scale_color_manual(values = c(main_white, main_black, main_white)) +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc)) +
scale_color_manual(values = c(white, black, white)) +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))  +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))  +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_wfp_b(palette = "fcg_colors") + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))  +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill(palette = "fcg_colors") + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))  +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(palette = "fcg_colors") + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))  +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual("fcg_colors") + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2
fcg_colors = c("Acceptable" = "#27AE60","Borderline" = "#F1C40F","Poor" = "#C0392B")
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))  +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc))  +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(values=fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2
?geom_text()
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7)
+geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc,position = position_stack(vjust = 0.5),show.legend = FALSE,size = 10/.pt)) +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(values=fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7)
+geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc,
position = position_stack(vjust = 0.5),show.legend = FALSE,size = 10/.pt)) +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(values=fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +
geom_text(aes(x = ADMIN1Name,y = perc,colour = FCSCat21,label = perc,
position = position_stack(vjust = 0.5),show.legend = FALSE,size = 10/.pt)) +
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(values=fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +geom_text(aes(x = residency_status,
y = freq,
color = fcs_classification,
label = paste0(round(freq,1), "%")),
position = position_stack(vjust = 0.5),
show.legend = FALSE,
size = 10/.pt,
)+
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(values=fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +geom_text(aes(x = residency_status,
y = perc,
color = FCSCat21,
label = perc),
position = position_stack(vjust = 0.5),
show.legend = FALSE,
size = 10/.pt,
)+
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(values=fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2
fcscat21_barplot2 <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +geom_text(aes(x = ADMIN1Name,
y = perc,
color = FCSCat21,
label = perc),
position = position_stack(vjust = 0.5),
show.legend = FALSE,
size = 10/.pt,
)+
labs(
title = "Household Food Consumption Score Classification by Residency Status | 2022",
subtitle = "Relative Proportion of Households per FCS Classification by Residency Status",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(values=fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot2
fcscat21_barplot <- fcscat21_admin1_table_long %>%
ggplot() +geom_col(aes(x = ADMIN1Name, y = perc,fill = FCSCat21), width = 0.7) +geom_text(aes(x = ADMIN1Name,
y = perc,
color = FCSCat21,
label = perc),
position = position_stack(vjust = 0.5),
show.legend = FALSE,
size = 10/.pt,
)+
labs(
title = "Household Food Consumption Score Classification by State | 2022",
subtitle = "",
caption = "Source: WFP VAM Unit \n© United Nations World Food Programme"
)  +  scale_fill_manual(values=fcg_colors) + theme_wfp(grid = "XY",
axis = FALSE,
axis_title = FALSE)
fcscat21_barplot
